<!DOCTYPE html>
<html>
<head>
    <title>OMDB - Movies</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <h1>Movies List</h1>

    <div>
        <input type="text" id="search" placeholder="Search by title">
        <input type="number" id="filterYear" placeholder="Filter by year">
        <select id="sortBy">
            <option value="title">Sort by Title</option>
            <option value="year">Sort by Year</option>
            <option value="rating">Sort by Rating</option>
        </select>
    </div>

    <div id="movies"></div>

    <script>
        const moviesDiv = document.getElementById('movies');
        const searchInput = document.getElementById('search');
        const filterYear = document.getElementById('filterYear');
        const sortBy = document.getElementById('sortBy');

        function fetchMovies() {
            let query = searchInput.value || '';
            let year = filterYear.value || '';
            let sort = sortBy.value || 'title';

            let url = `http://localhost:8000/api/movies/search?q=${query}`;
            if(year) url = `http://localhost:8000/api/movies/filter?year=${year}`;
            if(sort) url = `http://localhost:8000/api/movies/sort?by=${sort}`;

            fetch(url)
            .then(res=>res.json())
            .then(data=>{
                moviesDiv.innerHTML='';
                data.forEach(movie=>{
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <h3>${movie.title} (${movie.release_year})</h3>
                        <p>${movie.description}</p>
                        <p>Average Rating: ${movie.average_rating.toFixed(1)} ‚≠ê</p>
                        <a href="movie.html?id=${movie.id}">View / Add Review</a>
                    `;
                    moviesDiv.appendChild(div);
                });
            });
        }

        searchInput.addEventListener('input', fetchMovies);
        filterYear.addEventListener('input', fetchMovies);
        sortBy.addEventListener('change', fetchMovies);

        fetchMovies();
    </script>
</body>
</html>
